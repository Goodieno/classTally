<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>학급 점수판</title>
  <style>
    body { font-family: Arial, sans-serif; padding:20px; background:#f9fafb; }
    h1 { margin-bottom:20px; }
    ul { list-style:none; padding:0; }
    li { margin:8px 0; }
    a, button.link-btn { text-decoration:none; color:#2563eb; font-size:18px; cursor:pointer; background:none; border:none; padding:0; }
    a:hover, button.link-btn:hover { text-decoration:underline; }
    .grid { display:grid; gap:12px; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); }
    .card { border:1px solid #ddd; border-radius:8px; padding:12px; background:#fff; }
    .row { display:flex; justify-content:space-between; margin-bottom:10px; }
    .controls { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
    .controls input { grid-column:span 2; padding:6px; }
    .controls button { padding:8px; border:none; color:#fff; font-weight:bold; border-radius:6px; cursor:pointer; }
    .btn-add { background:#16a34a; }
    .btn-take { background:#dc2626; }
    .reasons { margin-top:10px; }
    .reason.add { color:#16a34a; font-weight:bold; background:#fff; padding:4px; border-radius:4px; }
    .reason.take { color:#dc2626; font-weight:bold; background:#fff; padding:4px; border-radius:4px; }
    .score { font-weight:bold; }
    .back { display:inline-block; margin-bottom:16px; color:#2563eb; text-decoration:none; }
    .grid-spacer { height: 2in; } /* extra space below grid */
    /* Admin link bottom-right */
    .admin-link {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 12px;
      opacity: 0.6;
      z-index: 1000;
    }
    .admin-link button.link-btn { color: #555; }
    .admin-link button.link-btn:hover { opacity: 1; text-decoration: underline; }
  </style>
</head>
<body>
  <div id="home">
    <h1>학년 선택</h1>
    <ul id="grade-links">
      <li><button class="link-btn" data-grade="1">1학년</button></li>
      <li><button class="link-btn" data-grade="2">2학년</button></li>
      <li><button class="link-btn" data-grade="3">3학년</button></li>
      <li><button class="link-btn" data-grade="4">4학년</button></li>
      <li><button class="link-btn" data-grade="5">5학년</button></li>
      <li><button class="link-btn" data-grade="6">6학년</button></li>
    </ul>
  </div>

  <div id="view"></div>

  <div class="admin-link">
    <button class="link-btn" id="admin-link">⚙️ Admin Panel</button>
  </div>

  <script>
    // 데이터 구조: 각 학년 8개 반
    const grades = {};
    for (let g=1; g<=6; g++) {
      grades[`${g}학년`] = {};
      for (let c=1; c<=8; c++) {
        grades[`${g}학년`][`${g}학년 ${c}반`] = { points:0, reasons:[] };
      }
    }

    function renderGrade(grade) {
      document.getElementById("home").style.display = "none";
      const view = document.getElementById("view");
      view.innerHTML = `
        <button class="link-btn back" id="back-home">← 학년으로 돌아가기</button>
        <h2>${grade}학년 학급 점수판</h2>
        <div class="grid"></div>
      `;
      const grid = view.querySelector(".grid");

      Object.entries(grades[`${grade}학년`]).forEach(([className, data]) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="row">
            <div>${className}</div>
            <div>총점: <span class="score">${data.points}</span></div>
          </div>
          <div class="controls">
            <input type="text" placeholder="이유 입력" class="reasonInput" maxlength="30"/>
            <button class="btn-add">+ 점수 추가</button>
            <button class="btn-take">− 점수 차감</button>
          </div>
          <div class="reasons"></div>
        `;
        const reasonEl = card.querySelector(".reasonInput");
        const scoreEl = card.querySelector(".score");
        const reasonsDiv = card.querySelector(".reasons");

        card.querySelector(".btn-add").onclick = () => {
          const reason = reasonEl.value.trim() || "이유 없음";
          data.points += 2;
          data.reasons.push({type:"add", amount:2, text:reason, ts:Date.now()});
          updateCard();
          reasonEl.value = "";
        };
        card.querySelector(".btn-take").onclick = () => {
          const reason = reasonEl.value.trim() || "이유 없음";
          data.points -= 1;
          data.reasons.push({type:"take", amount:1, text:reason, ts:Date.now()});
          updateCard();
          reasonEl.value = "";
        };

        function updateCard() {
          scoreEl.textContent = data.points;
          reasonsDiv.innerHTML = "";
          data.reasons.slice(-3).forEach(r => {
            const div = document.createElement("div");
            div.className = `reason ${r.type}`;
            const date = new Date(r.ts);
            const formatted = date.toLocaleString("ko-KR", {
              month: "2-digit",
              day: "2-digit",
              hour: "2-digit",
              minute: "2-digit"
            });
            div.textContent = (r.type==="add"?"+":"−")+r.amount+"점: "+r.text+" ("+formatted+")";
            reasonsDiv.appendChild(div);
          });
        }

        grid.appendChild(card);
      });

      // Spacer to avoid crowding admin link
      const spacer = document.createElement("div");
      spacer.className = "grid-spacer";
      view.appendChild(spacer);
    }

    function goHome() {
      document.getElementById("view").innerHTML = "";
      document.getElementById("home").style.display = "block";
    }

    function checkAdminPassword() {
      const pw = prompt("관리자 비밀번호를 입력하세요:");
      if (pw === "delete") {
        renderAdmin();
      } else if (pw !== null) {
        alert("비밀번호가 올바르지 않습니다.");
      }
    }

    function renderAdmin() {
      document.getElementById("home").style.display = "none";
      const view = document.getElementById("view");
      view.innerHTML = `
        <button class="link-btn back" id="back-home">← 학년으로 돌아가기</button>
        <h2>관리자 메뉴</h2>
        <p>학년별 점수를 초기화할 수 있습니다.</p>
        <ul id="adminList"></ul>
      `;
      const adminList = document.getElementById("adminList");
      for (let g = 1; g <= 6; g++) {
        const li = document.createElement("li");
        li.innerHTML = `<button class="link-btn" data-reset-grade="${g}">${g}학년 점수 초기화</button>`;
        adminList.appendChild(li);
      }

      const spacer = document.createElement("div");
      spacer.className = "grid-spacer";
      view.appendChild(spacer);
    }

    function resetGrade(grade) {
      if (!confirm(`${grade}학년의 모든 점수를 초기화하시겠습니까?`)) return;
      Object.values(grades[`${grade}학년`]).forEach(cls => {
        cls.points = 0;
        cls.reasons = [];
      });
      alert(`${grade}학년 점수가 초기화되었습니다.`);
    }

    // Single event listener handles all clicks
    document.addEventListener("click", (e) => {
      const target = e.target;

      // Grade selection
      if (target.matches('button[data-grade]')) {
        e.preventDefault();
        renderGrade(Number(target.dataset.grade));
        return;
      }

      // Back to home
      if (target.id === 'back-home') {
        e.preventDefault();
        goHome();
        return;
      }

      // Admin link
      if (target.id === 'admin-link') {
        e.preventDefault();
        checkAdminPassword();
        return;
      }

      // Reset grade in admin
      if (target.matches('button[data-reset-grade]')) {
        e.preventDefault();
        resetGrade(Number(target.dataset.resetGrade));
        return;
      }
    });

    // Expose if needed elsewhere
    window.renderGrade = renderGrade;
    window.goHome = goHome;
    window.checkAdminPassword = checkAdminPassword;
    window.renderAdmin = renderAdmin;
    window.resetGrade = resetGrade;
  </script>
</body>
</html>
