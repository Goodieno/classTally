<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>í•™ê¸‰ ì ìˆ˜íŒ</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background: #f9fafb;
}

h1, h2 {
  margin-bottom: 16px;
}

ul {
  list-style: none;
  padding: 0;
}

li {
  margin: 10px 0;
}

button.link-btn {
  background: none;
  border: none;
  color: #2563eb;
  font-size: 18px;
  cursor: pointer;
  padding: 0;
}

button.link-btn:hover {
  text-decoration: underline;
}

.leader-text {
  margin-left: 8px;
  font-weight: bold;
  color: #15803d;
}

.leader-score {
  color: #000;
  margin-left: 4px;
}

.badge {
  margin-left: 6px;
}

/* GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  max-width: 1000px;
  margin: 0 auto;
  gap: 14px;
}

.card {
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 12px;
  background: #fff;
}

.class-name {
  color: #2563eb;
  font-weight: bold;
}

.points {
  color: #14532d;
  font-weight: bold;
}

.controls {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
  margin-top: 8px;
}

.controls input {
  grid-column: span 2;
  padding: 6px;
}

.controls button {
  padding: 8px;
  border: none;
  color: #fff;
  font-weight: bold;
  border-radius: 6px;
  cursor: pointer;
}

.btn-add { background: #16a34a; }
.btn-take { background: #dc2626; }
.btn-undo {
  grid-column: span 2;
  background: #6b7280;
}

/* REASONS */
.reasons-wrapper {
  margin-top: 10px;
  max-height: 180px;
  overflow-y: auto;
  border: 1px solid #ddd;
  padding: 8px;
  border-radius: 8px;
  background: #fafafa;
}

.reason-entry {
  font-size: 14px;
  margin-bottom: 6px;
  padding-bottom: 6px;
  border-bottom: 1px dashed #ccc;
}

.reason-entry:last-child {
  border-bottom: none;
}

.reason-time {
  font-size: 12px;
  color: #666;
}

/* ADMIN */
.admin-link {
  position: fixed;
  bottom: 10px;
  right: 10px;
  opacity: 0.7;
}

.admin-link button {
  font-size: 12px;
  color: #555;
}
</style>
</head>

<body>

<div id="home">
  <h1>í•™ë…„ ì„ íƒ</h1>
  <ul id="grade-links"></ul>
</div>

<div id="view"></div>

<div class="admin-link">
  <button class="link-btn" id="admin-link">âš™ï¸ Admin</button>
</div>

<script>
/* DATA */
const grades = {};
for (let g = 1; g <= 6; g++) {
  grades[g] = {};
  for (let c = 1; c <= 8; c++) {
    grades[g][`${g}í•™ë…„ ${c}ë°˜`] = {
      points: 0,
      reasons: []
    };
  }
}

/* HOME */
function renderHome() {
  document.getElementById("view").innerHTML = "";
  document.getElementById("home").style.display = "block";

  const ul = document.getElementById("grade-links");
  ul.innerHTML = "";

  for (let g = 1; g <= 6; g++) {
    const li = document.createElement("li");
    const leaders = getLeaders(g);

    let leaderHTML = "";
    if (leaders.length === 1) {
      leaderHTML = `<span class="leader-text">ğŸ‘‘ ${leaders[0].name}<span class="leader-score">(${leaders[0].points})</span></span>`;
    } else if (leaders.length > 1) {
      leaderHTML = leaders.map(l =>
        `<span class="leader-text">ğŸ¥Š ${l.name}<span class="leader-score">(${l.points})</span></span>`
      ).join("");
    }

    li.innerHTML = `
      <button class="link-btn" data-grade="${g}">${g}í•™ë…„</button>
      ${leaderHTML}
    `;
    ul.appendChild(li);
  }
}

/* LEADER LOGIC */
function getLeaders(grade) {
  const classes = Object.entries(grades[grade]);
  const max = Math.max(...classes.map(c => c[1].points));
  if (max <= 0) return [];

  return classes
    .filter(c => c[1].points === max)
    .map(c => ({ name: c[0], points: c[1].points }));
}

/* GRADE PAGE */
function renderGrade(grade) {
  document.getElementById("home").style.display = "none";
  const view = document.getElementById("view");
  view.innerHTML = `
    <button class="link-btn" id="back-home">â† ëŒì•„ê°€ê¸°</button>
    <h2>${grade}í•™ë…„ ì ìˆ˜íŒ</h2>
    <div class="grid"></div>
  `;

  const grid = view.querySelector(".grid");

  Object.entries(grades[grade]).forEach(([name, data]) => {
    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <div>
        <span class="class-name">${name}</span> â€”
        ì´ì  <span class="points">${data.points}</span>
      </div>

      <div class="controls">
        <input placeholder="ì´ìœ  ì…ë ¥" maxlength="30">
        <button class="btn-add">+2</button>
        <button class="btn-take">-1</button>
        <button class="btn-undo" disabled>â†© Undo</button>
      </div>

      <div class="reasons-wrapper"></div>
    `;

    const input = card.querySelector("input");
    const scoreEl = card.querySelector(".points");
    const history = card.querySelector(".reasons-wrapper");
    const undoBtn = card.querySelector(".btn-undo");

    let lastAdded = null;

    function renderReasons() {
      history.innerHTML = "";
      data.reasons.forEach(r => {
        const div = document.createElement("div");
        div.className = "reason-entry";
        div.innerHTML = `<div>${r.text}</div><div class="reason-time">${r.time}</div>`;
        history.appendChild(div);
      });
      history.scrollTop = history.scrollHeight;
    }

    renderReasons();

    card.querySelector(".btn-add").onclick = () => {
      const text = input.value.trim();
      if (!text) return;
      const entry = { text: `+2ì : ${text}`, time: new Date().toLocaleString("ko-KR"), delta: 2 };
      data.points += 2;
      data.reasons.push(entry);
      lastAdded = entry;
      undoBtn.disabled = false;
      input.value = "";
      scoreEl.textContent = data.points;
      renderReasons();
    };

    card.querySelector(".btn-take").onclick = () => {
      const text = input.value.trim();
      if (!text) return;
      const entry = { text: `-1ì : ${text}`, time: new Date().toLocaleString("ko-KR"), delta: -1 };
      data.points -= 1;
      data.reasons.push(entry);
      lastAdded = entry;
      undoBtn.disabled = false;
      input.value = "";
      scoreEl.textContent = data.points;
      renderReasons();
    };

    undoBtn.onclick = () => {
      if (!lastAdded) return;
      data.points -= lastAdded.delta;
      data.reasons.pop();
      lastAdded = null;
      undoBtn.disabled = true;
      scoreEl.textContent = data.points;
      renderReasons();
    };

    grid.appendChild(card);
  });
}

/* ADMIN */
function checkAdminPassword() {
  if (prompt("ë¹„ë°€ë²ˆí˜¸") === "delete") renderAdmin();
}

function renderAdmin() {
  document.getElementById("home").style.display = "none";
  const view = document.getElementById("view");
  view.innerHTML = `<button class="link-btn" id="back-home">â† ëŒì•„ê°€ê¸°</button><h2>ê´€ë¦¬ì</h2>`;
  for (let g = 1; g <= 6; g++) {
    const btn = document.createElement("button");
    btn.className = "link-btn";
    btn.textContent = `${g}í•™ë…„ ì´ˆê¸°í™”`;
    btn.onclick = () => {
      if (!confirm("ì´ˆê¸°í™”?")) return;
      Object.values(grades[g]).forEach(c => { c.points = 0; c.reasons = []; });
      alert("ì™„ë£Œ");
    };
    view.appendChild(btn);
    view.appendChild(document.createElement("br"));
  }
}

/* EVENTS */
document.addEventListener("click", e => {
  if (e.target.dataset.grade) renderGrade(+e.target.dataset.grade);
  if (e.target.id === "back-home") renderHome();
  if (e.target.id === "admin-link") checkAdminPassword();
});

renderHome();
</script>

</body>
</html>
